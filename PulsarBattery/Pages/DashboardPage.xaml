<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="PulsarBattery.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <ScrollViewer>
        <Grid Padding="32,24,32,32">
            <StackPanel Spacing="24" MaxWidth="1000">

                <!-- Loading indicator (shown when no data is available yet) -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="40"
                        MinHeight="200"
                        Visibility="{Binding LoadingVisibility}">
                    <StackPanel HorizontalAlignment="Center" 
                                VerticalAlignment="Center" 
                                Spacing="16">
                        <ProgressRing IsActive="True" 
                                      Width="48" 
                                      Height="48" />
                        <TextBlock Text="Loading battery information..." 
                                   Style="{ThemeResource BodyStrongTextBlockStyle}"
                                   HorizontalAlignment="Center" />
                        <TextBlock Text="Please wait while we connect to your device" 
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

                <!-- No Device Found indicator -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="40"
                        MinHeight="300"
                        Visibility="{Binding NoDeviceVisibility}">
                    <StackPanel HorizontalAlignment="Center" 
                                VerticalAlignment="Center" 
                                Spacing="20">
                        <Border Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                CornerRadius="32"
                                Width="64"
                                Height="64"
                                HorizontalAlignment="Center">
                            <FontIcon Glyph="&#xE7EF;" 
                                      FontSize="32"
                                      Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        </Border>
                        <TextBlock Text="No Pulsar mouse detected" 
                                   Style="{ThemeResource TitleTextBlockStyle}"
                                   HorizontalAlignment="Center" />
                        <StackPanel Spacing="8" MaxWidth="450">
                            <TextBlock Style="{ThemeResource BodyTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       TextAlignment="Center"
                                       TextWrapping="Wrap">
                                Make sure your Pulsar mouse is connected and powered on.
                            </TextBlock>
                            <TextBlock Style="{ThemeResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                       TextAlignment="Center"
                                       TextWrapping="Wrap"
                                       Margin="0,8,0,0">
                                Supported devices: X2 CrazyLight, X2 V1
                            </TextBlock>
                        </StackPanel>
                        <Button Content="Retry" 
                                Style="{ThemeResource AccentButtonStyle}"
                                HorizontalAlignment="Center"
                                Margin="0,8,0,0"
                                Click="RetryConnection_Click" />
                    </StackPanel>
                </Border>

                <!-- Main content (shown when data is available) -->
                <StackPanel Spacing="24" Visibility="{Binding ContentVisibility}">

                    <!-- Battery Status Card -->
                    <Grid>
                        <!-- Loading indicator when refreshing with cached data -->
                        <StackPanel Orientation="Horizontal" 
                                    Spacing="8" 
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Margin="0,0,0,8"
                                    Visibility="{Binding RefreshingVisibility}">
                            <ProgressRing IsActive="True" 
                                          Width="16" 
                                          Height="16" />
                            <TextBlock Text="Updating..." 
                                       Style="{ThemeResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       VerticalAlignment="Center" />
                        </StackPanel>

                        <!-- Main battery card -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="16"
                                MinHeight="120">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- Left side - Battery info -->
                                <StackPanel Grid.Row="0" Grid.Column="0" Spacing="4" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding ModelName}" 
                                               Style="{ThemeResource BodyStrongTextBlockStyle}"
                                               TextTrimming="CharacterEllipsis" />
                                    <TextBlock Text="{Binding ChargingStateText}" 
                                               Style="{ThemeResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                    <TextBlock Text="{Binding LastUpdatedText}" 
                                               Style="{ThemeResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                                </StackPanel>

                                <!-- Right side - Large percentage -->
                                <TextBlock Grid.Row="0" Grid.Column="1"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Right"
                                           FontSize="56"
                                           FontWeight="SemiBold"
                                           Margin="24,0,0,0">
                                    <Run Text="{Binding BatteryPercentage}" /><Run Text="%" FontSize="40" />
                                </TextBlock>

                                <!-- Progress bar (full width) -->
                                <ProgressBar Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                             Minimum="0" 
                                             Maximum="100"
                                             Value="{Binding BatteryPercentage}"
                                             Height="6"
                                             Margin="0,16,0,0" />
                            </Grid>
                        </Border>
                    </Grid>

                    <!-- Device Information Section -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="Device information" 
                                   Style="{ThemeResource BodyStrongTextBlockStyle}"
                                   Margin="0,0,0,8" />

                        <!-- Model -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="16"
                                Margin="0,0,0,2">
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <FontIcon Grid.Column="0"
                                          Glyph="&#xE8D4;" 
                                          FontSize="16"
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          VerticalAlignment="Center" />

                                <TextBlock Grid.Column="1" 
                                           Text="Model" 
                                           Style="{ThemeResource BodyStrongTextBlockStyle}"
                                           VerticalAlignment="Center" />

                                <TextBlock Grid.Column="2" 
                                           Text="{Binding ModelName}" 
                                           Style="{ThemeResource BodyTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           TextTrimming="CharacterEllipsis"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </Border>

                        <!-- Battery Level -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="16"
                                Margin="0,0,0,2">
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <FontIcon Grid.Column="0"
                                          Glyph="&#xE83F;" 
                                          FontSize="16"
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          VerticalAlignment="Center" />

                                <TextBlock Grid.Column="1" 
                                           Text="Battery level" 
                                           Style="{ThemeResource BodyStrongTextBlockStyle}"
                                           VerticalAlignment="Center" />

                                <TextBlock Grid.Column="2" 
                                           Style="{ThemeResource BodyTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           VerticalAlignment="Center">
                                    <Run Text="{Binding BatteryPercentage}" /><Run Text="%" />
                                </TextBlock>
                            </Grid>
                        </Border>

                        <!-- Charging Status -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="16"
                                Margin="0,0,0,2">
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <FontIcon Grid.Column="0"
                                          Glyph="&#xEBAA;" 
                                          FontSize="16"
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          VerticalAlignment="Center" />

                                <TextBlock Grid.Column="1" 
                                           Text="Charging status" 
                                           Style="{ThemeResource BodyStrongTextBlockStyle}"
                                           VerticalAlignment="Center" />

                                <TextBlock Grid.Column="2" 
                                           Text="{Binding ChargingStateText}" 
                                           Style="{ThemeResource BodyTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </Border>

                        <!-- Last Updated -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="16"
                                Margin="0,0,0,2">
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <FontIcon Grid.Column="0"
                                          Glyph="&#xE8DF;" 
                                          FontSize="16"
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          VerticalAlignment="Center" />

                                <TextBlock Grid.Column="1" 
                                           Text="Last updated" 
                                           Style="{ThemeResource BodyStrongTextBlockStyle}"
                                           VerticalAlignment="Center" />

                                <TextBlock Grid.Column="2" 
                                           Text="{Binding LastUpdatedText}" 
                                           Style="{ThemeResource BodyTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           TextTrimming="CharacterEllipsis"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </Border>
                    </StackPanel>

                </StackPanel>

            </StackPanel>
        </Grid>
    </ScrollViewer>
</Page>
